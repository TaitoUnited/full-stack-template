# NOTE: Remove all extra containers that you don't need.

# TODO nginx as a frontend server so that the same docker-compose file works
# also with production containers and cors is not required for development.

# server-template-admin:
#   container_name: server-template-admin
#   build: ./admin
#   restart: always
#   ports:
#     - "3333:3333"
#   volumes:
#     - "./admin:/app"
#     - "/app/node_modules"
#   links:
#     - server-template-server:server-template-server
#   environment:
#     COMMON_ENV: local
#     API_ROOT: 'http://0.0.0.0:3331'
#     API_URL: ''

server-template-client:
  container_name: server-template-client
  build: ./client
  restart: always
  ports:
    - "3333:3333"
  volumes:
    - "./client:/app"
    - "/app/node_modules"
  links:
    - server-template-server:server-template-server
  environment:
    COMMON_ENV: local
    API_ROOT: 'http://0.0.0.0:3332'
    API_URL: ''

server-template-server:
  container_name: server-template-server
  build: ./server
  restart: always
  ports:
    - "3332:3332"
  volumes:
    - "./server:/app"
    - "/app/node_modules"
  links:
    - server-template-cache:server-template-cache
    - server-template-database:server-template-database
    - server-template-bucket:server-template-bucket
  environment:
    COMMON_ENV: local
    COMMON_DEBUG: 'true'
    COMMON_PROJECT: server-template
    COMMON_CUSTOMER: customername
    APP_EXAMPLE: example
    ENV: dev
    DEBUG: 'true'
    API_BINDADDR: 0.0.0.0
    API_PORT: 3332
    BUCKET_HOST: server-template-bucket
    BUCKET_ID: server_template_local
    BUCKET_REGION: europe-west1-c
    BUCKET_PROTOCOL: http
    BUCKET_ACCESS_KEY: 070UEOQR6LX4YPZLFU0V
    BUCKET_SECRET_KEY: CVQVa33NekSiOJGnevSY5ITr8Rql8lFkp22WhLQ+
    DATABASE_HOST: server-template-database
    DATABASE_ID: server_template_local
    DATABASE_DB: server_template_local
    DATABASE_USER: server_template_local_app
    DATABASE_SECRET: secret
    DATABASE_POOL_MAX: '10'
    # TODO remove obsolete env variables

server-template-cache:
  container_name: server-template-cache
  image: redis
  restart: always
  ports:
    - "6379:6379"

# "EXTERNAL RESOURCES"

server-template-database:
  container_name: server-template-database
  image: kiasaki/alpine-postgres:9.5
  restart: always
  ports:
    - "5432:5432"
  environment:
    POSTGRES_DB: server_template_local
    POSTGRES_USER: server_template_local_app
    POSTGRES_PASSWORD: secret
  volumes:
    - "./database:/docker-entrypoint-initdb.d"

server-template-bucket:
  container_name: server-template-bucket
  image: minio/minio
  restart: always
  command: server /export
  ports:
    - "9000:9000"
  environment:
    MINIO_ACCESS_KEY: 070UEOQR6LX4YPZLFU0V
    MINIO_SECRET_KEY: CVQVa33NekSiOJGnevSY5ITr8Rql8lFkp22WhLQ+
